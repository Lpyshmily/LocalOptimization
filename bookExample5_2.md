# bookExample5_2

本程序的目标是实现《深空探测动力学与控制》第五章中的第二个算例，从地球到木星经火星引力辅助的交会问题

## 1st version

* 引力辅助后开启发动机：完成了PSO搜索引力辅助的最佳时刻，并计算最小的脉冲速度增量
* 公共近星点开启发动机：采用割线法目前无法得到非线性方程的收敛解

## 2nd version

* 将PSO搜索引力辅助时刻的头文件和源文件名字改为`GA_PSO`
* 小推力求解的文件名称为`GA_FOP`
* 不再将`mjd_middle`作为参数进行传递，直接从`Constant.h`头文件中读取
* 目前已经完成了导数的计算，打靶方程偏差的计算，还没有进行打靶方程的求解。

## 3rd version

* 完成了整个程序的编程，没有报错，但是迭代计算第一步起就不正常。
* 修正了一个错误：引力辅助后在原来的速度上加上速度改变量`dvg`，仍不能正常运行。

## 4th version

* 修正了一个错误，`GA_fvec()`函数中，A、B、C赋值时，索引值从1开始，应该从0开始。
* 改变了速度增量的初值猜测方法。

* 修正了一个错误，$V_{\infty}^+$的计算方式有误

```c++
V_Add(vinfout, &rv_tm[3], dvg, 3);
// 应改为下面这种
V_Add(vinfout, vinfin, dvg, 3);
```

## 5th version

* 又检查了一遍，没有发现问题。

## 6th version

* 按照蒋老师的指导意见，修改程序

1. 调用`hybrid1`函数时，`wa`的维数至少为`n(3n+13)/2`，本程序中打靶变量个数$n=17$，因此将`wa`的维数改为600。

2. 调用`hybrid1`函数时，最后一个参数设大一些，改为2000。

3. 修改一些初值猜测值的猜测范围。

4. 暂时取消向文件中读写的操作。

5. 把PSO搜索到的引力辅助时刻当作初始值

   修改之后，Debug模式下step过大的问题不再出现，这个问题之前应该是`wa`维数设置的太小导致的。

   目前希望通过增加猜测次数，寻找收敛解。

## 7th version

* 从迟师姐的Fortran程序中获取猜测初值
  * 长度单位是km
  * 归一化：长度，AU；时间，年；质量，初始质量
  * 打靶变量：[1]lam0,[2]lamm,[3]lamk,[4-6]lamr,[7-9]lamv,[10-13]lamx,[14-16]dvg,[17]tm
  * 打靶方程：
  * 采用同伦参数为0.0004的初值，前13个猜测值的2范数为1。对速度增量进行修改，然后带入我的程序，不收敛。
  * 采用同伦参数为0.00065的初值，也未能收敛。
  * 迟师姐所用的打靶方程是$rp-rmin$，而我用的是$1-\frac{rp}{rmin}$，对应的乘子可能会相差一个倍数
    * 将这个乘子乘以$rmin$，然后再重新归一化，仍然未能收敛。
    * 将我的打靶方程改为$rmin-rp$，未能收敛。
    * 将我的打靶方程改为$rp-rmin$，未能收敛。

## 8th version

* 采用同伦参数为1/2e-6的初值，也未能收敛。

## 9th version

* 学习蒋老师的程序，猜测16个初值，转化为17个自动满足协态归一化条件的打靶变量。

  改动之后，需要注意引力辅助时刻的表达方式：蒋老师程序中用的是出发后经过的年份，我的程序是前一段时间所占的百分比。

* 更改初始条件中速度的处理方式，由直接除以2pi，改为先除以一年的秒数，再乘上时间归一化的数值

* 计算rp时，除以rmin

## 10th version

* 增加随机猜测次数为1000，进行多次计算，目前共计算出两组结果

  将两组计算结果作为猜测初值，一步即可收敛。

  第一组计算结果中不等式约束对应的乘子接近为零，等号不成立，进入调试模式，发现rp小于rmin，不满足不等式约束。

  第二组计算结果中不等式约束对应的乘子为8.996530e-3，进入调试模式，rp和rmin几乎相等，符合要求。

## 11th version

* 采用第二组计算结果当作正确的计算结果，从1开始进行同伦。

  同伦参数逐渐减小，剩余质量逐渐增大。

  但并不是中间过程的每一个同伦参数都能收敛，有时候几个不收敛，后面反而可以收敛。

  通过不断减小补偿，同伦至0.000012，剩余质量为16021.554kg

## 12th version

* 编写bang-bang控制和二次同伦下，计算导数和Hamilton的函数。
* 利用对数同伦过程中同伦参数为0.000012时的计算结果作为初值，求解bang-bang控制，相关函数用`type1`区分，没有得到收敛的结果。

## 13th version

* 学习蒋老师程序中的二次同伦、带开关函数检测定步长积分，并编写对应程序，相关函数使用`type2`区分
* 由于和蒋老师程序中时间归一化的标准不同，可以将积分步长适当增大，由5e-4增大到1e-3，得到一组计算结果，但不满足不等式约束。